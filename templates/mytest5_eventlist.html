<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>
    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

    <style>
        .moveip {
            position: relative;
            top: -20px;
            right: -10%
        }

        .eventComplete {
            background-color: rgb(188, 225, 255);
            /* 一般來說z-index的數字愈大，代表愈上層，同理愈小，代表愈底層。 */
            /* z-index:-100;position: relative; */
        }

        .myJumpout {
            position: relative;
            animation: jumpout 0.9s linear;
        }

        @keyframes jumpout {
            /* from {  background-image: url("./img/offline_normal.png"); }
            to   { 
               
                background-image: url("./img/offline_squat.png");
             } */

            0% {}

            20% {
                top: -20px
            }

            25% {
                top: -20px;
                right: -10%
            }

            70% {
                top: -20px;
                right: -10%
            }

            /* 50% {
                top: -20px;
                right: -30%
            } */

            /* 75% {
                top: -20px;
                right: -60%
            } */

            100% {
                top: -20px;
                right: -100%
            }

        }
    </style>
</head>

<body>
    <!-- Header -->
    <div class="container">
        <header
            class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
            <div class="col-md-3 mb-2 mb-md-0">
                <a href="/myImg" class="d-inline-flex link-body-emphasis text-decoration-none bi bi-tsunami">
                    <!-- <svg class="bi" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"/></svg> -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor"
                        class="bi bi-tsunami" viewBox="0 0 16 16">
                        <path
                            d="M.036 12.314a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.757-.703a.5.5 0 0 1-.278-.65zm0 2a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.757-.703a.5.5 0 0 1-.278-.65zM2.662 8.08c-.456 1.063-.994 2.098-1.842 2.804a.5.5 0 0 1-.64-.768c.652-.544 1.114-1.384 1.564-2.43.14-.328.281-.68.427-1.044.302-.754.624-1.559 1.01-2.308C3.763 3.2 4.528 2.105 5.7 1.299 6.877.49 8.418 0 10.5 0c1.463 0 2.511.4 3.179 1.058.67.66.893 1.518.819 2.302-.074.771-.441 1.516-1.02 1.965a1.878 1.878 0 0 1-1.904.27c-.65.642-.907 1.679-.71 2.614C11.076 9.215 11.784 10 13 10h2.5a.5.5 0 0 1 0 1H13c-1.784 0-2.826-1.215-3.114-2.585-.232-1.1.005-2.373.758-3.284L10.5 5.06l-.777.388a.5.5 0 0 1-.447 0l-1-.5a.5.5 0 0 1 .447-.894l.777.388.776-.388a.5.5 0 0 1 .447 0l1 .5a.493.493 0 0 1 .034.018c.44.264.81.195 1.108-.036.328-.255.586-.729.637-1.27.05-.529-.1-1.076-.525-1.495-.426-.42-1.19-.77-2.477-.77-1.918 0-3.252.448-4.232 1.123C5.283 2.8 4.61 3.738 4.07 4.79c-.365.71-.655 1.433-.945 2.16-.15.376-.301.753-.463 1.13z" />
                    </svg>
                </a>
            </div>

            <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
                <li><a href="/myImg" class="nav-link px-2 link-secondary">首頁</a></li>
                <li><a href="/myImg" class="nav-link px-2">圖像工具</a></li>
                <li><a href="/myeventList" class="nav-link px-2">任務清單</a></li>
                <li><a href="/histogram1" class="nav-link px-2">說明</a></li>
                <!-- <li><a href="#" class="nav-link px-2">About</a></li> -->
            </ul>

            <div class="col-md-3 text-end">
                <!-- <button type="button" class="btn btn-outline-primary me-2">Login</button>
            <button type="button" class="btn btn-primary">Sign-up</button> -->
                <a href="/" class="btn btn-outline-primary me-2">登出</a>
                <!-- <a href="/signup" class="btn btn-primary">Sign-up</a> -->
            </div>
        </header>
    </div>
    <!-- --------------------------------------------------------------------  -->
    <div class="container">

        <h1>
            任務清單
            <a href="/myeventList_addNew" class="btn btn-outline-success btn-md float-right">
                新增
            </a>
        </h1>

        <table id="jobList" class="table table-hover">
            <thead>
                <tr>
                    <th>
                        項目名稱
                    </th>
                    <th>
                        <!-- 是否已完工 -->
                    </th>
                    <th>&nbsp;</th>
                </tr>
            </thead>
            <tbody>
                <tr data-myComplete=1>
                    <td>
                        Job A
                    </td>
                    <td>
                        <!-- <input class="check-box" disabled="disabled" type="checkbox" /> -->
                    </td>
                    <td>
                        <span class="float-end">
                            <a href="edit.html" class="btn btn-outline-primary btn-sm">編輯</a> |
                            <button href="delete.html" class="btn btn-outline-danger btn-sm">刪除</button>
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <script>
        // getZIndex = function (e) {
        //     var z = window.getComputedStyle(e).getPropertyValue('z-index');
        //     if (isNaN(z)) return window.getZIndex(e.parentNode);
        //     return z;
        // };

        function delay(milliseconds) {
            return new Promise(resolve => {
                setTimeout(resolve, milliseconds);
            });
        }

        $('#jobList tbody').on('click', 'tr td[id^=list]', async function () {
            // console.log($(this));
            // console.log($(this)[0]);
            // console.log($(this).prop('id').split('_')[1]);
            // console.log($(this).data("mycomplete"));
            // console.log(this.getAttribute("data-myComplete"));
            // console.log(this.dataset.mycomplete);
            // !!!!!data 自訂義名稱 在.dataset.變數名 呼叫時默認全小寫

            const mytrid = '#listTrId' + $(this).prop('id').split('_')[1];
            if ($(mytrid).data("mycomplete") == "1") {
                // console.log('ok');
                $(mytrid).addClass("myJumpout");
                // -----------------------------
                var dataToServer = {
                    todoTableId: $(this).prop('id').split('_')[1]
                };
                var result = await $.ajax({
                    type: "put",
                    url: "/eventlist/item/clickComplete",
                    contentType: "application/json",
                    data: JSON.stringify(dataToServer)
                });
                
                // -----------------------------
                await delay(900);

                // console.log(getZIndex(this[0]));
                // console.log(this);

                var obj = $(mytrid).remove();
                // console.log(obj[0]);
                obj.data("mycomplete", "0");
                // console.log(obj.data("mycomplete"));
                // console.log('#list_'+$(this).prop('id').split('_')[1]+'_space');
                obj.removeClass("myJumpout");
                obj.addClass("eventComplete");
                $("#jobList tbody").append(obj);
                $('#list_' + $(this).prop('id').split('_')[1] + '_space').append(
                    '<span style="color: rgb(33, 135, 59);font-weight: 800;">Complete!</span>'
                );


                
            }

        });


        function load_event_list() {
            $.get("/eventlist/list", function (e) {
                // console.log(e);
                todoTable = e;
                $("#jobList tbody").empty();
                var ClassComplete = ['', 'class = "eventComplete"']
                var textComplete = ['', '<span style="color: rgb(33, 135, 59);font-weight: 800;">Complete!</span>']
                for (var i = 0; i < todoTable.length; i++) {
                    var checkControl = [];
                    var strNew = `<tr data-myComplete= ${1 - todoTable[i].isComplete} id="listTrId${todoTable[i].todoTableId}" ${ClassComplete[todoTable[i].isComplete]}>
                    <td id="list_${todoTable[i].todoTableId}_title">
                        ${todoTable[i].title}
                    </td>
                    <td id="list_${todoTable[i].todoTableId}_space">
                        ${textComplete[todoTable[i].isComplete]}
                        <!-- <input class="check-box" disabled="disabled" type="checkbox" /> -->
                    </td>
                    <td style="width: 175px;">
                        <span class="float-end">
                            <a href="/myeventList_Edit" class="btn btn-outline-primary btn-sm" onclick = "doedit(${todoTable[i].todoTableId})">編輯</a> |
                            <button  class="btn btn-outline-danger btn-sm" onclick = "dodelet(${todoTable[i].todoTableId})">刪除</button>
                        </span>
                    </td>
                    </tr>`;


                    $("#jobList tbody").append(strNew);
                }
            })
        }
        load_event_list();

        function doedit(e) {
            // alert(e);
            sessionStorage.setItem("myListId", e);
        };

        async function dodelet(e) {
            // alert(e);
            // sessionStorage.setItem("id",e);
            var delUrl = "/eventlist/delete/" + e;
            var result = await $.ajax({
                type: "delete",
                url: delUrl
            });
            // console.log(result);
            // window.location = "/myeventList";  //會閃
            load_event_list();
        };

    </script>

</body>